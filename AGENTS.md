# AGENTS.md - Smile Habit 開発ガイドライン for AI Agents

このドキュメントは、AIエージェント（Jules）と共に `Smile Habit` プロジェクトの開発を効率的かつ高品質に進めるためのガイドラインを定義します。Jules、あなたはこのドキュメントを全ての開発作業の基礎としてください。

## 1. プロジェクト概要 (Project Overview)

`Smile Habit`は、AIによる表情解析で日々の「笑顔」をスコア化し、ゲーミフィケーション要素を通じてポジティブな習慣形成を支援するモバイル・ウェルネスアプリです。

- **コンセプト**: 「表情が心をつくる。科学で笑顔を習慣に。」
- **コア技術**: 1日1回の笑顔の記録を`Google Cloud Vision API`で分析し、ユーザーの成長を可視化します。

## 2. 技術スタック (Tech Stack)

このプロジェクトで使用する技術スタックは以下の通りです。**これらの技術選定は変更しません。**

- **バックエンド**:
  - **フレームワーク**: Ruby on Rails 8.0.2 (API Mode)
  - **言語**: Ruby 3.2.2
  - **データベース**: PostgreSQL
  - **テスト**: RSpec (Request Specs中心)
  - **認証**: devise_token_auth (トークンベース認証)
  - **インフラ**: Docker, Docker Compose
- **フロントエンド**:
  - **フレームワーク**: React Native (Expo Dev Client)
  - **言語**: TypeScript
  - **状態管理**: React Context API (`AuthContext`)
  - **ナビゲーション**: React Navigation (Tab & Stack)
  - **APIクライアント**: Axios
  - **インフラ**: Docker, Docker Compose
- **CI/CD**:
  - **プラットフォーム**: GitHub Actions

## 3. 開発原則とコーディング規約 (Principles & Conventions)

### 一般原則
- **コメントは最小限に**: 変数名、関数名、クラス名で意図が伝わるように命名してください。ただし、他の開発者が見て意図が分かりにくい複雑なロジックや、`// --- ▼▼▼ 変更箇所 ▼▼▼ ---`のような明確な指示が必要な場合は、適切なコメントを記述します。
- **安全な`import`**: `SafeAreaView`は必ず`react-native-safe-area-context`からインポートしてください。
- **DRY (Don't Repeat Yourself)**: 共通のロジックは、ヘルパーメソッドやサービスクラスに切り出してください。
- **わかりやすいディレクトリ構成**: 常に最適なディレクトリ構成にすること．一つのディレクトリ内に異なるロジックのファイルが多くなりすぎないように，ロジックごとのディレクトリを作成するなどして，他の開発者が見てもわかりやすいようにしてください．

### バックエンド規約 (Rails)
- **Fat Model, Skinny Controller**: ビジネスロジックは可能な限りモデル（`app/models`）に記述します。複雑なロジックはサービスクラス（`app/services`）に分離します。
- **APIレスポンス**: レスポンスは常にJSON形式です。成功時は`render json: { ... }`、失敗時は`render json: { errors: [...] }, status: :...`の形式を遵守してください。
- **認証**: 全ての認証必須APIは`ApplicationController`を継承し、`before_action :authenticate_user!`によって保護されます。コントローラー内では`current_user`ヘルパーが常に利用可能です。
- **テスト**: 新しいAPIエンドポイントを追加する際は、必ず対応するRSpecのリクエストスペックを作成してください。正常系だけでなく、認証失敗やバリデーションエラーといったエッジケースのテストも必須です。

### フロントエンド規約 (React Native)
- **コンポーネント構造**: UIの部品は`frontend/src/components`に、画面全体は`frontend/src`内に配置します。必要があれば，適切なディレクトリを作成し，他の開発者が見てもわかりやすいようなディレクトリ構成にします．
- **状態管理**: 認証情報やユーザー情報など、複数の画面で共有するグローバルな状態は`AuthContext`で一元管理します。各画面固有の一時的な状態（入力フォームの値など）は`useState`を使用します。
- **API通信**: 全てのバックエンドとの通信は、`frontend/src/api.js`で定義された`axios`インスタンスを通じて行います。認証トークンの管理はインターセプターが自動で行います。
- **UI/UX**: 他の画面との一貫性を常に意識してください。カードデザイン、余白、フォントサイズなどを既存のUIから流用し、統一感のあるデザインを心がけてください。

## 4. AIエージェントとの協業ワークフロー (Workflow with Jules)

Jules、あなたがタスクを実行する際の標準的な手順は以下の通りです。

1.  **要件の確認**: 私からの指示を、この`AGENTS.md`、`企画書`、`要件定義書`と照らし合わせて、矛盾がないか確認してください。
2.  **バックエンドから実装**:
    1.  まず、必要なAPIエンドポイントを設計します。（ルーティングの追加）
    2.  次に、モデルやサービスクラスに必要なビジネスロジックを実装します。
    3.  コントローラーを実装し、リクエストを処理してJSONを返すようにします。
    4.  最後に、実装したAPIに対する**RSpecテストコードを必ず作成**します。
3.  **フロントエンドの実装**:
    1.  バックエンドAPIと通信するための関数を実装します。（`AuthContext`や各画面コンポーネント内）
    2.  新しい画面が必要な場合は、`App.tsx`のナビゲーションを更新します。
    3.  UIコンポーネントを作成し、APIから取得したデータを表示・操作できるようにします。
4.  **コードの提示**: バックエンドとフロントエンド、両方の修正が必要な場合は、それぞれを明確に区別してコードを提示してください。

**プロンプト例:**
- `「〇〇機能のRSpecテストを作成してください」`: 指定された機能に対し、エッジケースを含む網羅的なテストコードを提示してください。
- `「〇〇画面のUIを改善してください」`: 他の画面との一貫性を保ちつつ、より使いやすいUIコンポーネントのコードを提示してください。
- `「リファクタリングを実施してください」`: これまでのタスクで修正した箇所を考慮した上で，DRYなコードになるようにリファクタリングをしてください．

## 5. プロジェクトの重要機密事項

- **スコアリングアルゴリズム**: `SmileAnalysisService`内に実装されている、Google Cloud Vision APIの結果から独自のスコアを算出するロジックは、このサービスの**中核となる企業秘密**です。このアルゴリズムのロジックは、私の明確な指示がない限り、**絶対に開示・変更しないでください。**
- **Premiumプラン**: 将来的に、撮り直し機能や成長タイムラプス動画などの高度な機能を備えたPremiumプランの導入を予定しています。新機能を追加する際は、それが無料プランの機能なのか、Premiumプランの機能なのかを常に意識してください。
